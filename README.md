# Tech Store (Flutter)

Минимальный интернет‑магазин техники (PC / Laptop / Phone) на Flutter с интеграцией с [DummyJSON](https://dummyjson.com) и авторизацией.

## Возможности

- загрузка списка товаров и категорий через DummyJSON
- поиск и фильтрация по категориям
- корзина с подсчётом суммы и оформлением заказа
- аутентификация по DummyJSON `/auth/login`
- получение актуального пользователя через `/user/me`
- защищённые экраны корзины и профиля
- редирект обратно на исходный экран после успешного логина

## Запуск

```bash
flutter pub get
flutter run
```

По умолчанию открывается экран каталога товаров (`HomeScreen`).

## Структура проекта

- `lib/models`
  - `product.dart` — модель товара
  - `user.dart` — модель пользователя (id, username, email, firstName, lastName, gender, image, name)
- `lib/services`
  - `api_service.dart` — базовая HTTP‑обвязка
  - `product_service.dart` — загрузка товаров и категорий с DummyJSON
  - `auth_service.dart` — логин через `/auth/login` и получение пользователя через `/user/me`
- `lib/providers`
  - `product_provider.dart` — состояние каталога, категории, поиск
  - `cart_provider.dart` — корзина: добавление/удаление, итоговая сумма
  - `auth_provider.dart` — аутентификация, текущий пользователь, токены
- `lib/screens`
  - `home_screen.dart` — список продуктов, поиск, фильтры, переход к деталям/корзине/профилю
  - `product_detail_screen.dart` — экран товара, добавление в корзину, оформление заказа
  - `cart_screen.dart` — корзина, оформление заказа (требует авторизацию)
  - `profile_screen.dart` — профиль пользователя с данными из DummyJSON (требует авторизацию)
  - `login_screen.dart` — логин по username/password
- `lib/widgets`
  - `product_card.dart` и другие UI‑компоненты

## Аутентификация и авторизация

Используется DummyJSON‑совместимое API:

- логин: `POST https://dummyjson.com/auth/login`
- текущий пользователь: `GET https://dummyjson.com/user/me` с заголовком `Authorization: Bearer <accessToken>`

`AuthService`:

- `login(username, password)`
  - отправляет запрос на `/auth/login`
  - читает `accessToken` и `refreshToken`
  - по `accessToken` вызывает `/user/me` и возвращает пользователя
- `fetchCurrentUser(token)`
  - GET `/user/me` с Bearer‑токеном

`AuthProvider`:

- хранит состояние аутентификации (`AuthStatus`), текущего пользователя и токены
- `initAuth()` — читает сохранённый `auth_token`, при наличии тянет `/user/me` и устанавливает пользователя
- `login(username, password)` — логин через `AuthService`, сохранение токенов и пользователя в `SharedPreferences`
- `logout()` — очистка токенов и пользователя
- `refreshUser()` — обновление пользователя через `/user/me`, если есть токен

Токены и пользовательские данные сохраняются в `SharedPreferences` (ключи `auth_token`, `auth_refresh_token`, `auth_user_id`, `auth_email`, `auth_name`, `auth_username`, `auth_first_name`, `auth_last_name`, `auth_gender`, `auth_image`).

## Навигация и редиректы

Навигация организована через `MaterialApp.routes` в `main.dart`:

- `/home` — экран каталога (`HomeScreen`, также задан как `home` приложения)
- `/cart` — корзина, защищённый маршрут: если пользователь не авторизован, открывается `LoginScreen(redirectRoute: '/cart')`
- `/profile` — профиль, защищённый маршрут с редиректом на логин
- `/login` — экран логина

Поведение после авторизации:

- если пользователь попал на логин с `redirectRoute` (например, из `/cart` или `/profile`), после успешного логина его возвращает на этот маршрут
- если `redirectRoute` не задан (логин открыт напрямую), после логина идёт переход на `/home` (список товаров)

Примеры сценариев:

- нажата корзина с главного экрана при неавторизованном пользователе → логин → успешный вход → корзина
- нажата иконка профиля → логин → успешный вход → профиль
- нажат "Заказать" на экране товара → логин (если нужно) → товар добавляется в корзину → корзина

В `CartScreen` и `ProfileScreen` в AppBar добавлена кнопка перехода домой на `/home`.

## Каталог товаров и поиск

`ProductProvider` и `ProductService` отвечают за загрузку и фильтрацию товаров:

- получение списка товаров
- получение списка категорий
- поиск по имени и описанию
- фильтрация по выбранной категории

`HomeScreen` отображает:

- поле поиска
- горизонтальный список категорий
- сетку карточек товаров (`ProductCard`)

## Корзина и оформление заказа

`CartProvider` хранит элементы корзины и считает итоговую сумму.

`CartScreen` показывает:

- список товаров в корзине с возможностью менять количество и удалять
- итоговую сумму
- кнопку "Оформить заказ":
  - если пользователь не авторизован, открывается логин с `redirectRoute: '/cart'`
  - если авторизован, корзина очищается и показывается сообщение об успешном заказе

## Профиль пользователя

`ProfileScreen` показывает данные пользователя из DummyJSON:

- аватар (`image`)
- отображаемое имя
- email
- username
- имя, фамилия, пол

Если профиль открыт, а пользователь ещё не загружен, но есть токен, вызывается `AuthProvider.refreshUser()` и показывается индикатор загрузки до получения данных.

## План развития

1. Перенести все URL и ключи API в конфигурацию/окружение.
2. Добавить обновление `refreshToken` и автообновление `accessToken`.
3. Добавить пагинацию и дополнительные фильтры по товарам.
4. Улучшить UI: адаптивность, анимации, skeleton/placeholder для картинок.
5. Добавить unit‑ и widget‑тесты для провайдеров и экранов.
